<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finalized Offer Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .final-container {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            text-align: center;
        }

        .button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
        }

        .button:hover {
            background-color: #45a049;
        }

        #contentContainer {
            margin-bottom: 20px;
            text-align: left;
        }

        #signatureContainer {
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="final-container">
        <h1>Finalized Offer Document</h1>
        <p>This document consolidates the content of the offer and your signature.</p>

        <!-- Container to load conditional.html content -->
        <div id="contentContainer"></div>

        <!-- Container for the signature -->
        <div id="signatureContainer">
            <p><i>No signature added yet. Please sign the document in the previous step.</i></p>
        </div>

        <!-- Button to generate the PDF -->
        <button class="button" onclick="generatePDF()">Generate PDF</button>
    </div>

    <script>
        let signatureData = '';

        // Load content from conditional.html
        async function loadConditionalContent() {
            const response = await fetch('conditional.html');
            const html = await response.text();
            document.getElementById('contentContainer').innerHTML = html;

            // If signature exists, display it
            const storedSignature = localStorage.getItem('signature');
            if (storedSignature) {
                signatureData = storedSignature;
                document.getElementById('signatureContainer').innerHTML = `
                    <h3>Signature:</h3>
                    <img src="${signatureData}" alt="Signature" style="max-width: 100%; border: 1px solid #ccc; padding: 10px;">
                `;
            }
        }

        // Generate PDF
        function generatePDF() {
            if (!signatureData) {
                alert('No signature available. Please sign the document first.');
                return;
            }

            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();

            // Add conditional.html content
            const contentHTML = document.getElementById('contentContainer').innerHTML;
            pdf.html(contentHTML, {
                callback: function (pdf) {
                    // Add the signature
                    pdf.addImage(signatureData, 'PNG', 15, 150, 100, 50);
                    pdf.save('Final_Offer_Document.pdf');
                },
                x: 15,
                y: 10,
            });
        }

        // Load content on page load
        loadConditionalContent();
    </script>
</body>
</html>
